import { City } from '@/data/cities';
import { ServiceCategory } from '@/data/services';

export type PriceRow = { label: string; min: number; max: number; unit: string };

export interface ServiceCityContent {
  title: string;
  meta: string;
  h1: string;
  intro: string;
  valueProps: string[];
  included: string[];
  addons: string[];
  priceRows: PriceRow[];
  faqs: { q: string; a: string }[];
  example: string;
  related: {
    subservices: string[];
    siblings: string[];
  };
}

export function composeServiceCityContent(params: {
  city: City;
  service: ServiceCategory;
}): ServiceCityContent {
  const { city, service } = params;

  // Base content templates
  const templates = {
    moving: {
      intro: `نوفر خدمة نقل العفش في ${city.name_ar} بأعلى معايير الاحترافية والأمان. فريقنا المتخصص يصل إلى ${city.neighborhoods?.[0] || city.name_ar} وجميع الأحياء الأخرى في غضون 30-60 دقيقة. نستخدم أحدث المعدات وأفضل مواد التغليف لضمان سلامة عفشك أثناء النقل.`,
      valueProps: [
        'فريق محترف مدرب ومعتمد',
        'تغليف احترافي بمواد عالية الجودة',
        'ونش كهربائي لرفع العفش',
        'تأمين شامل على جميع المنقولات',
        'ضمان مكتوب على الخدمة',
      ],
      included: [
        'معاينة مجانية وتقييم دقيق',
        'فك وتركيب الأثاث',
        'تغليف وتحميل العفش',
        'النقل بسيارات مجهزة',
        'التنزيل وإعادة التركيب',
      ],
      addons: [
        'تخزين مؤقت للعفش',
        'تنظيف المنزل القديم',
        'تركيب الستائر والديكورات',
        'نقل خارج المدينة',
      ],
      priceRows: [
        { label: 'شقة صغيرة (غرفتين)', min: 800, max: 1200, unit: 'ريال' },
        { label: 'شقة متوسطة (3-4 غرف)', min: 1500, max: 2500, unit: 'ريال' },
        { label: 'فيلا كبيرة', min: 3000, max: 5000, unit: 'ريال' },
      ],
      faqs: [
        {
          q: `كم تستغرق خدمة نقل العفش في ${city.name_ar}؟`,
          a: `تعتمد المدة على حجم المنزل والمسافة. عادة تستغرق شقة متوسطة من 4-6 ساعات في ${city.name_ar}.`,
        },
        {
          q: 'هل يوجد ضمان على سلامة العفش؟',
          a: 'نعم، نوفر تأمين شامل وضمان مكتوب على جميع المنقولات.',
        },
        {
          q: 'هل الأسعار تشمل التغليف والفك والتركيب؟',
          a: 'نعم، أسعارنا شاملة التغليف والفك والتركيب ومواد التغليف.',
        },
        {
          q: 'هل تقدمون خدمة التخزين المؤقت؟',
          a: 'نعم، لدينا مستودعات آمنة ومكيفة للتخزين المؤقت.',
        },
        {
          q: `هل تنقلون إلى خارج ${city.name_ar}؟`,
          a: `نعم، نقدم خدمة النقل من وإلى ${city.name_ar} لجميع مدن المملكة.`,
        },
      ],
      example: `مثال: عائلة في حي ${city.neighborhoods?.[0] || 'المدينة'} احتاجت نقل فيلا من دورين إلى ${city.neighborhoods?.[1] || 'حي آخر'}. وصل فريقنا في الموعد المحدد، قام بتغليف جميع القطع بعناية، استخدم الونش لرفع الأثاث الثقيل، وأنهى العمل في 6 ساعات بدون أي تلفيات.`,
    },
    cleaning: {
      intro: `خدمة تنظيف منازل احترافية في ${city.name_ar} على أيدي فريق مدرب ومجهز بأحدث المعدات. نغطي ${city.neighborhoods?.[0] || city.name_ar} وجميع الأحياء بخدمات تنظيف شاملة تشمل الأرضيات، النوافذ، المطابخ، الحمامات وجميع الغرف.`,
      valueProps: [
        'فريق تنظيف محترف ومدرب',
        'مواد تنظيف آمنة وصديقة للبيئة',
        'معدات حديثة وفعالة',
        'مرونة في المواعيد',
        'أسعار تنافسية وباقات مميزة',
      ],
      included: [
        'تنظيف الأرضيات والسجاد',
        'مسح النوافذ والزجاج',
        'تنظيف المطابخ والحمامات',
        'إزالة الأتربة والغبار',
        'تعطير المنزل',
      ],
      addons: [
        'تنظيف الكنب والمجالس',
        'جلي وتلميع الرخام',
        'تنظيف الخزانات',
        'تعقيم شامل',
      ],
      priceRows: [
        { label: 'شقة صغيرة', min: 300, max: 500, unit: 'ريال' },
        { label: 'شقة متوسطة', min: 500, max: 800, unit: 'ريال' },
        { label: 'فيلا كبيرة', min: 1000, max: 2000, unit: 'ريال' },
      ],
      faqs: [
        {
          q: `كم تستغرق خدمة التنظيف في ${city.name_ar}؟`,
          a: 'تعتمد على حجم المنزل. شقة متوسطة تحتاج 3-4 ساعات، والفيلا قد تستغرق 6-8 ساعات.',
        },
        {
          q: 'هل المواد المستخدمة آمنة؟',
          a: 'نعم، نستخدم مواد تنظيف آمنة ومعتمدة وصديقة للبيئة.',
        },
        {
          q: 'هل يمكن التنظيف في غيابي؟',
          a: 'نعم، يمكننا التنظيف في غيابك بكل أمان واحترافية.',
        },
        {
          q: 'هل توفرون المعدات ومواد التنظيف؟',
          a: 'نعم، نأتي مجهزين بكامل المعدات ومواد التنظيف.',
        },
        {
          q: 'هل يوجد عقود تنظيف شهرية؟',
          a: 'نعم، نوفر عقود تنظيف أسبوعية وشهرية بأسعار مخفضة.',
        },
      ],
      example: `مثال: عائلة في ${city.neighborhoods?.[0] || city.name_ar} طلبت تنظيف عميق لفيلا من دورين بعد التشطيب. وصل فريق من 4 عمال مع جميع المعدات، نظفوا الأرضيات، مسحوا الزجاج، نظفوا المطابخ والحمامات بالكامل، وأنهوا العمل في 7 ساعات مع نتيجة مبهرة.`,
    },
    'pest-control': {
      intro: `خدمة مكافحة حشرات احترافية في ${city.name_ar} باستخدام أحدث التقنيات والمبيدات الآمنة. نوفر حلولاً فعالة لجميع أنواع الحشرات في ${city.neighborhoods?.[0] || city.name_ar} وجميع أنحاء المدينة مع ضمان طويل المدى.`,
      valueProps: [
        'مبيدات آمنة ومعتمدة صحياً',
        'فنيون متخصصون ومرخصون',
        'ضمان يصل إلى 6 أشهر',
        'شهادة بلدية معتمدة',
        'استخدام تقنيات حديثة',
      ],
      included: [
        'معاينة مجانية وتقييم',
        'رش جميع المناطق المستهدفة',
        'معالجة الشقوق والفتحات',
        'إرشادات الوقاية',
        'ضمان على الخدمة',
      ],
      addons: [
        'مكافحة القوارض والفئران',
        'مكافحة النمل الأبيض',
        'عقود صيانة سنوية',
        'شهادة بلدية للتجديد',
      ],
      priceRows: [
        { label: 'شقة صغيرة', min: 200, max: 350, unit: 'ريال' },
        { label: 'شقة متوسطة', min: 350, max: 550, unit: 'ريال' },
        { label: 'فيلا كبيرة', min: 600, max: 1000, unit: 'ريال' },
      ],
      faqs: [
        {
          q: 'هل المبيدات آمنة على الأطفال والحيوانات؟',
          a: 'نعم، نستخدم مبيدات معتمدة من وزارة الصحة وآمنة تماماً.',
        },
        {
          q: 'كم تستغرق مدة الرش؟',
          a: 'عادة من 30-60 دقيقة حسب مساحة المكان.',
        },
        {
          q: 'متى يمكن العودة للمنزل بعد الرش؟',
          a: 'يفضل الانتظار 2-3 ساعات فقط ثم يمكن العودة بأمان.',
        },
        {
          q: `هل الخدمة تشمل شهادة بلدية في ${city.name_ar}؟`,
          a: 'نعم، نوفر شهادة بلدية معتمدة للاستخدامات الرسمية.',
        },
        {
          q: 'ما هي مدة الضمان؟',
          a: 'نوفر ضمان من 3-6 أشهر حسب نوع الخدمة.',
        },
      ],
      example: `مثال: منزل في ${city.neighborhoods?.[0] || city.name_ar} كان يعاني من الصراصير والنمل. قام الفني بمعاينة شاملة، رش المبيدات في جميع الأماكن المستهدفة، عالج الشقوق، وقدم إرشادات وقائية. النتيجة: اختفاء كامل للحشرات خلال 48 ساعة.`,
    },
    'leaks-plumbing': {
      intro: `خدمة كشف تسربات المياه والسباكة في ${city.name_ar} باستخدام أحدث الأجهزة الإلكترونية والحرارية. نصل إلى ${city.neighborhoods?.[0] || city.name_ar} وجميع الأحياء بسرعة لحل مشاكل التسربات والسباكة.`,
      valueProps: [
        'أجهزة كشف إلكترونية متطورة',
        'فنيون سباكة خبراء',
        'كشف دقيق بدون تكسير',
        'ضمان على الإصلاحات',
        'خدمة طوارئ 24/7',
      ],
      included: [
        'فحص شامل بالأجهزة',
        'تحديد مكان التسرب بدقة',
        'تقرير مفصل بالحالة',
        'توصيات العلاج',
        'ضمان على الكشف',
      ],
      addons: [
        'إصلاح التسربات',
        'عزل الحمامات والخزانات',
        'تسليك المجاري',
        'تبديل المواسير',
      ],
      priceRows: [
        { label: 'كشف تسرب عادي', min: 300, max: 500, unit: 'ريال' },
        { label: 'كشف بالأجهزة الحرارية', min: 500, max: 800, unit: 'ريال' },
        { label: 'إصلاح شامل', min: 1000, max: 3000, unit: 'ريال' },
      ],
      faqs: [
        {
          q: `كم تستغرق عملية كشف التسرب في ${city.name_ar}؟`,
          a: 'عادة من 1-2 ساعة حسب مساحة المكان وموقع التسرب.',
        },
        {
          q: 'هل الكشف يتطلب تكسير؟',
          a: 'لا، نستخدم أجهزة إلكترونية للكشف بدون تكسير.',
        },
        {
          q: 'ما هي علامات وجود تسرب؟',
          a: 'ارتفاع فاتورة المياه، رطوبة في الجدران، صوت مياه جارية، أو بقع مياه.',
        },
        {
          q: 'هل تقدمون خدمة الإصلاح أيضاً؟',
          a: 'نعم، نوفر خدمة الكشف والإصلاح مع ضمان.',
        },
        {
          q: 'هل الخدمة متوفرة في الطوارئ؟',
          a: 'نعم، خدمة طوارئ متاحة 24/7 في جميع أنحاء المدينة.',
        },
      ],
      example: `مثال: فيلا في ${city.neighborhoods?.[0] || city.name_ar} كانت تعاني من ارتفاع فاتورة المياه. استخدم الفني جهاز الكشف الإلكتروني وحدد تسرباً تحت البلاط في الحمام خلال ساعة واحدة، ثم قام بإصلاحه بضمان 5 سنوات.`,
    },
    ac: {
      intro: `خدمة صيانة وتنظيف المكيفات في ${city.name_ar} على أيدي فنيين معتمدين. نوفر خدمات شاملة لجميع أنواع المكيفات في ${city.neighborhoods?.[0] || city.name_ar} وجميع الأحياء مع ضمان معتمد.`,
      valueProps: [
        'فنيون معتمدون من الشركات',
        'قطع غيار أصلية',
        'خدمة سريعة في نفس اليوم',
        'ضمان على الصيانة',
        'أسعار منافسة وواضحة',
      ],
      included: [
        'فحص شامل للمكيف',
        'تنظيف الفلاتر والمواسير',
        'فحص الفريون والضاغط',
        'تشخيص الأعطال',
        'تقرير الحالة',
      ],
      addons: [
        'شحن فريون',
        'تبديل قطع تالفة',
        'تركيب مكيفات جديدة',
        'عقود صيانة دورية',
      ],
      priceRows: [
        { label: 'تنظيف مكيف سبليت', min: 80, max: 150, unit: 'ريال' },
        { label: 'صيانة شاملة', min: 150, max: 300, unit: 'ريال' },
        { label: 'إصلاح عطل', min: 200, max: 500, unit: 'ريال' },
      ],
      faqs: [
        {
          q: 'كم مرة يحتاج المكيف للتنظيف؟',
          a: 'يفضل تنظيف المكيف كل 3-6 أشهر للحفاظ على كفاءته.',
        },
        {
          q: 'ما هي علامات حاجة المكيف للصيانة؟',
          a: 'ضعف التبريد، روائح كريهة، أصوات غريبة، أو تسريب مياه.',
        },
        {
          q: 'هل توفرون قطع غيار أصلية؟',
          a: 'نعم، نستخدم فقط قطع غيار أصلية مع ضمان الوكيل.',
        },
        {
          q: `كم تستغرق الصيانة في ${city.name_ar}؟`,
          a: 'التنظيف العادي 30-45 دقيقة، والصيانة الشاملة 1-2 ساعة.',
        },
        {
          q: 'هل يوجد ضمان على الصيانة؟',
          a: 'نعم، نوفر ضمان على العمل والقطع المستبدلة.',
        },
      ],
      example: `مثال: عائلة في ${city.neighborhoods?.[0] || city.name_ar} كانت تعاني من ضعف تبريد المكيف. قام الفني بفحص شامل، نظف الفلاتر والمواسير، شحن الفريون، وأصلح تسريباً صغيراً. عاد المكيف للعمل بكفاءة 100% في أقل من ساعتين.`,
    },
  };

  const serviceSlug = service.slug as keyof typeof templates;
  let template = templates[serviceSlug];
  
  // Default template if service not found
  if (!template) {
    template = {
      intro: `نوفر خدمة ${service.name_ar} في ${city.name_ar} بأعلى معايير الجودة والاحترافية. فريقنا المتخصص يصل إلى ${city.neighborhoods?.[0] || city.name_ar} وجميع الأحياء في المدينة.`,
      valueProps: [
        'فريق محترف ومدرب',
        'خدمة سريعة وموثوقة',
        'أسعار تنافسية',
        'ضمان على الخدمة',
        'استجابة سريعة',
      ],
      included: [
        'معاينة مجانية',
        'تقييم دقيق',
        'تنفيذ احترافي',
        'ضمان مكتوب',
      ],
      addons: ['خدمات إضافية حسب الطلب'],
      priceRows: [
        { label: 'خدمة صغيرة', min: 200, max: 400, unit: 'ريال' },
        { label: 'خدمة متوسطة', min: 400, max: 800, unit: 'ريال' },
        { label: 'خدمة كبيرة', min: 800, max: 1500, unit: 'ريال' },
      ],
      faqs: [
        {
          q: `كم تستغرق الخدمة في ${city.name_ar}؟`,
          a: 'تعتمد المدة على حجم العمل ونوع الخدمة المطلوبة.',
        },
        {
          q: 'هل يوجد ضمان؟',
          a: 'نعم، نوفر ضمان مكتوب على جميع خدماتنا.',
        },
        {
          q: 'كيف يمكنني الحجز؟',
          a: 'يمكنك الاتصال بنا مباشرة أو عبر واتساب للحجز.',
        },
        {
          q: 'هل الأسعار شاملة؟',
          a: 'نعم، أسعارنا شاملة الضريبة وجميع المواد.',
        },
        {
          q: 'هل الخدمة متوفرة في جميع الأحياء؟',
          a: `نعم، نغطي جميع أحياء ${city.name_ar}.`,
        },
      ],
      example: `مثال: عميل في ${city.neighborhoods?.[0] || city.name_ar} طلب الخدمة، وصل الفريق في الموعد المحدد، أنجز العمل باحترافية، وحصل على ضمان مكتوب.`,
    };
  }

  return {
    title: `خدمة ${service.name_ar} في ${city.name_ar} | ضمان وأسعار واضحة | بروكر`,
    meta: `خدمة ${service.name_ar} في ${city.name_ar} مع فِرق معتمدة وضمان مكتوب وزمن استجابة سريع. اطلب تسعيرة دقيقة الآن.`,
    h1: `خدمة ${service.name_ar} في ${city.name_ar}`,
    intro: template.intro,
    valueProps: template.valueProps,
    included: template.included,
    addons: template.addons,
    priceRows: template.priceRows,
    faqs: template.faqs,
    example: template.example,
    related: {
      subservices: service.subservices.map((s) => s.slug).slice(0, 6),
      siblings: [],
    },
  };
}
